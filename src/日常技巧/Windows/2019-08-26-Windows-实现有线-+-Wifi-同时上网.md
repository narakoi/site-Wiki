---
layout: post
title: Windows 实现有线 + Wifi 同时上网（分管内外网）
date: 2019-08-26 09:14
author: 熊猫小A
toc: ture
categories: 
  - 日常技巧
  - Windows
tags:
  - Windows
---

现在的笔记本大多是双网卡，一个有线一个无线。若同时连上有线与 Wifi，Windows 优先使用有线连接。有时我们需要两者皆能联网，例如我的场景：Wifi 连接实验室内网，有线连接校园网，方便挂 PT。那么可按本文操作如下。

首先连接有线与无线，在 CMD 管理员模式中输出当前路由表：

```
route print
```

顶部两行以 0.0.0.0 开头的路由即分别是有线与无线连接，注意最后一项「跃点数」，数值越低优先级越高。之所以不能在使用有线时同时使用 WiFi 就是由于这两条路由打架，系统按照跃点数选择了有线连接：

```
网络目标    网络掩码     网关            接口               跃点数
0.0.0.0    0.0.0.0    172.17.104.1    172.17.105.76     26
0.0.0.0    0.0.0.0    192.168.2.1     192.168.2.102     35
```

要做的是删除其中一条，并重新添加为合理的路由形式。本文中保留有线连接不动（172.17.x.x）,调整 Wifi 连接（192.168.x.x）。

首先记下上面的路由表，然后删除原来的路由：

```
route delete 0.0.0.0
```

重新添加有线路由，注意内容要和上面对应

```
route add 0.0.0.0 mask 0.0.0.0  172.17.104.1
```

即这个格式：

```
route add 网络目标 mask 网络掩码 网关
```

然后添加 WiFi 内网路由，这里认为 192.168.0.0/16（即 192.168.x.x）都属于实验室内网，则子网掩码为 255.255.0.0，网关为之前路由表的结果：

```
route add 192.168.0.0 mask 255.255.0.0 192.168.2.1
```

即可。

---

大多数情况下网关地址不会轻易改变，因此可以将以上流程写成批处理文件：

```bat
%1 mshta vbscript:CreateObject("Shell.Application").ShellExecute("cmd.exe","/c %~s0 ::","","runas",1)(window.close)&&exit
route delete 0.0.0.0
route add 0.0.0.0 mask 0.0.0.0  172.17.104.1
route add 192.168.0.0 mask 255.255.0.0 192.168.2.1
```

其中第一行是请求管理员权限。

网络盛传的把以上路由都添加为永久路由的方法不推荐，因为如此的话重启后也不会变回正常状态，可能影响电脑在别处联网。最好保存为批处理，在合适的时候运行一下即可，若有不对重启即可恢复原本状态。